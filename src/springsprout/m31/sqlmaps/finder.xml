<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="finder">
    <resultMap id="tree" class="springsprout.m31.domain.FinderTree">
        <result property="id" column="ID"/>
        <result property="text" column="FILE_NAME"/>
        <result property="defaultYn" column="DEFAULT_YN"/>
        <result property="parentId" column="PARENT_ID"/>
        <result property="iconCls" column="ICONCLS"/>
    </resultMap>

      <resultMap id="file" class="springsprout.m31.domain.FinderFile">
        <result property="fileId" column="ID"/>
        <result property="fileName" column="FILE_NAME"/>
        <result property="defaultYn" column="DEFAULT_YN"/>
        <result property="parentId" column="PARENT_ID"/>
        <result property="iconCls" column="ICONCLS"/>
        <result property="linkAppId" column="LINK_APP_ID"/>
        <result property="fileAddition" column="FILE_ADDITION_INFO"/>
    </resultMap>

    <select id="getTree" resultMap="tree" parameterClass="hashMap">
        SELECT
        ID,
        FILE_NAME,
        PARENT_ID,
        DEFAULT_YN,
        ICONCLS
        FROM SPRING_FINDER
        WHERE MEMBER_ID = #memberId#
        AND PARENT_ID = #parentId#
        AND FILE_TYPE = 'F'
    </select>

    <select id="getFiles" resultMap="file" parameterClass="hashMap">
        <isNotEqual property="parentId" compareValue="1">
        SELECT
            #parentId# as ID,
            '..' as FILE_NAME,
            (select parent_id from spring_finder where id = #parentId#) as PARENT_ID,
            'Y' as DEFAULT_YN,
            'up-folder' as ICONCLS,
            'springfinder' as LINK_APP_ID,
            '' as FILE_ADDITION_INFO
        FROM dual
        union all
        </isNotEqual>
        SELECT
            ID,
            FILE_NAME,
            PARENT_ID,
            DEFAULT_YN,
            ICONCLS||'-'||LINK_APP_ID as ICONCLS,
            LINK_APP_ID,
            FILE_ADDITION_INFO
        FROM SPRING_FINDER
        WHERE MEMBER_ID = #memberId#
        AND PARENT_ID = #parentId#
    </select>

    <select id="getParentNodeId" resultClass="int" parameterClass="hashMap">
        SELECT
            id
        FROM SPRING_FINDER sf
        WHERE
             SF.MEMBER_ID = #memberId#
        AND SF.DEFAULT_YN = 'Y'
        AND link_app_id = #link_app_id#
    </select>

    <update id="updateFile"  parameterClass="springsprout.m31.domain.FinderFile">
        UPDATE SPRING_FINDER SET file_name =#fileName# , PARENT_ID = #parentId# WHERE id =#fileId#
    </update>
</sqlMap>